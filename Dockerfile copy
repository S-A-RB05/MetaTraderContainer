# Base image with Ubuntu 20.04
FROM ubuntu:20.04

# Set the working directory
WORKDIR /app

# Update the package list and install required packages
RUN dpkg --add-architecture i386 && \
    apt-get update && \
    apt-get install -y wget software-properties-common gnupg2 && \
    wget -nc https://dl.winehq.org/wine-builds/winehq.key && \
    apt-key add winehq.key && \
    add-apt-repository 'deb https://dl.winehq.org/wine-builds/ubuntu/ focal main' && \
    apt-get update && \
    apt-get install -y winehq-stable && \
    rm -rf /var/lib/apt/lists/*

# Download Metatrader
RUN wget https://download.mql5.com/cdn/web/metaquotes.software.corp/mt5/mt5setup.exe -O mt5setup.exe

# Install Metatrader
RUN wine mt5setup.exe /S && \
    rm mt5setup.exe

# Set environment variables for Wine
ENV WINEARCH=win64 \
    WINEPREFIX=/root/.wine \
    DISPLAY=:0 \
    LANG=en_US.UTF-8

# Expose the default Metatrader port
EXPOSE 443

# Set the entrypoint to run Metatrader
ENTRYPOINT ["wine", "/root/.wine/drive_c/Program Files/MetaTrader 5/terminal64.exe"]
